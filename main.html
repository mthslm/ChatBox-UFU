<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>ChatBox UFU</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

</head>

<body>

    <section class="msger">
        <header class="msger-header">
            <div class="msger-header-title">
                <i class="fas fa-comment-alt"></i> ChatBot para dúvidas frequentes
            </div>
            <div class="msger-header-options">
                <span><i class="fas fa-cog"></i></span>
            </div>
        </header>

        <main class="msger-chat">



        </main>

        <form class="msger-inputarea">
            <input type="text" class="msger-input" placeholder="Escreva sua dúvida">
            <button type="submit" class="msger-send-btn">Enviar</button>
        </form>
    </section>

    <script>
        const qaList = [
            {
                question: "Qual é o nome da série de TV baseada nos livros de George R. R. Martin?",
                answer: "O nome da série de TV é Game of Thrones."
            },
            {
                question: "Quem são os protagonistas da série Game of Thrones?",
                answer: "Os protagonistas da série são vários personagens, mas os mais conhecidos são Jon Snow, Daenerys Targaryen e Tyrion Lannister."
            },
            {
                question: "Qual é a casa mais poderosa em Game of Thrones?",
                answer: "A casa mais poderosa em Game of Thrones é a Casa Lannister, que controla a maior parte da riqueza do reino."
            },
            {
                question: "Quem é o antagonista principal em Game of Thrones?",
                answer: "O antagonista principal em Game of Thrones é o Rei da Noite, que lidera o exército dos mortos-vivos."
            },
            {
                question: "Qual é o nome da espada de Jon Snow em Game of Thrones?",
                answer: "O nome da espada de Jon Snow é Longclaw."
            },
            {
                question: "Qual é o nome da região em que Daenerys Targaryen nasceu?",
                answer: "Daenerys Targaryen nasceu na região de Essos, na cidade de Valíria."
            },
            {
                question: "Quem matou Joffrey Baratheon em Game of Thrones?",
                answer: "Joffrey Baratheon foi envenenado por Olenna Tyrell, a matriarca da Casa Tyrell."
            },
            {
                question: "Qual é o nome da cidade onde Cersei Lannister se tornou rainha em Game of Thrones?",
                answer: "Cersei Lannister se tornou rainha na cidade de Porto Real."
            },
            {
                question: "Qual é o nome da casa que governa o Norte em Game of Thrones?",
                answer: "A casa que governa o Norte é a Casa Stark."
            }
        ];

        const fuse = new Fuse(qaList, {
            keys: ['question']
        });

        function getAnswer(question) {
            const result = fuse.search(question);

            if (result.length > 0) {
                return result[0].item.answer;
            } else {
                return "Desculpe, não entendi a sua pergunta.";
            }
        }

        // Teste do chatbot
        const question = "Qual é a capital do brasil?";
        const answer = getAnswer(question);
        console.log(answer); // A capital do Brasil é Brasília.



        //parte do chat
        const msgerForm = get(".msger-inputarea");
        const msgerInput = get(".msger-input");
        const msgerChat = get(".msger-chat");



        // Icons made by Freepik from www.flaticon.com
        const BOT_IMG = "https://upload.wikimedia.org/wikipedia/commons/thumb/6/65/Ufu_logo.svg/2048px-Ufu_logo.svg.png";
        const PERSON_IMG = "https://www.svgrepo.com/show/167320/boy.svg";
        const BOT_NAME = "Coordenador Virtual";
        const PERSON_NAME = "Aluno";

        msgerForm.addEventListener("submit", event => {
            event.preventDefault();

            const msgText = msgerInput.value;
            if (!msgText) return;

            appendMessage(PERSON_NAME, PERSON_IMG, "right", msgText);
            msgerInput.value = "";

            botResponse(msgText);
        });

        function appendMessage(name, img, side, text) { //nome, imagem, lado (left(esquerda), right(direita))
            //   Simple solution for small apps
            const msgHTML = `
    <div class="msg ${side}-msg">
      <div class="msg-img" style="background-image: url(${img})"></div>

      <div class="msg-bubble">
        <div class="msg-info">
          <div class="msg-info-name">${name}</div>
          <div class="msg-info-time">${formatDate(new Date())}</div>
        </div>

        <div class="msg-text">${text}</div>
      </div>
    </div>
  `;

            msgerChat.insertAdjacentHTML("beforeend", msgHTML);
            msgerChat.scrollTop += 500;
        }

        function botResponse(question) {

            const msgText = getAnswer(question);
            const delay = msgText.split(" ").length * 100;

            setTimeout(() => {
                appendMessage(BOT_NAME, BOT_IMG, "left", msgText);
            }, delay);
        }

        // Utils
        function get(selector, root = document) {
            return root.querySelector(selector);
        }

        function formatDate(date) {
            const h = "0" + date.getHours();
            const m = "0" + date.getMinutes();

            return `${h.slice(-2)}:${m.slice(-2)}`;
        }

        function random(min, max) {
            return Math.floor(Math.random() * (max - min) + min);
        }

    </script>

</body>

</html>